<div>
    <mat-form-field *ngFor="let filter of filterSelectObj" style="margin-left: 15px;">
      <mat-label>Filter {{filter.name}}</mat-label>
      <select matNativeControl name="{{filter.columnProp}}" [(ngModel)]="filter.modelValue"
        (change)="filterChange(filter,$event)">
        <option value="">-- Select {{filter.name}} --</option>
        <option [value]="item" *ngFor="let item of filter.options">{{item}}</option>
      </select>
    </mat-form-field>
    &nbsp;
    <button mat-flat-button color="warn" (click)="resetFilters()">Reset</button>
  </div>

<table mat-table [dataSource]="dataSource">

    <ng-container matColumnDef="id">
      <th mat-header-cell *matHeaderCellDef> id </th>
      <td mat-cell *matCellDef="let element" > {{element.id}} </td>
    </ng-container>

    <ng-container matColumnDef="name">
      <th mat-header-cell *matHeaderCellDef> name </th>
      <td mat-cell *matCellDef="let element" > {{element.name}} </td>
    </ng-container>

    <ng-container matColumnDef="publication_date">
      <th mat-header-cell *matHeaderCellDef> publication_date </th>
      <td mat-cell *matCellDef="let element"> {{element.publication_date}} </td>
    </ng-container>

    <ng-container matColumnDef="author">
      <th mat-header-cell *matHeaderCellDef> author </th>
      <td mat-cell *matCellDef="let element"> {{element.author}} </td>
    </ng-container>

    <ng-container matColumnDef="category">
      <th mat-header-cell *matHeaderCellDef> category </th>
      <td mat-cell *matCellDef="let element"> {{element.category.name}} </td>
    </ng-container>

    <ng-container matColumnDef="borrow">
      <th mat-header-cell *matHeaderCellDef> borrow </th>
      <td mat-cell *matCellDef="let element"> {{element.borrow}} 
        <button (click)="edithBook(element.id)"    mat-flat-button color="primary" class="mr-3">Editar</button>
        <button (click)="deleteBook(element.id)"  mat-flat-button color="accent" class="mr-3">Borrar</button>

        <!--botones de accion modal-->
        <div class="mt-3">

          <!-- Button to Open the Modal -->
          <div *ngIf="element.borrow == 0">
              <button type="button"  class="btn btn-success" data-toggle="modal" [attr.data-target]="'#myModal'+element.id">
                  Status
              </button>
          </div>


          <div *ngIf="element.borrow == 1">
              <button type="button"  (click)='searchBookStatus(element.id)' class="btn btn-success" data-toggle="modal" [attr.data-target]="'#myModal'+element.id">
                  Status
              </button>
          </div>

          
          <!-- The Modal -->
          <div class="modal" id="myModal{{element.id}}">
            <div class="modal-dialog">
                <div class="modal-content">

                <!-- Modal Header -->
                <div class="modal-header">
                    <h4 class="modal-title">Status de libro: {{element.name}}</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>

                <!-- Modal body -->
                <div class="modal-body">

                    <ul>
                        <li>Nombre: {{element.name}}</li>
                        <li *ngIf="element.borrow == 0">Disponible</li>
                        <div *ngIf="element.borrow == 1">
                            <li >No disponible</li>
                            <div *ngIf="bookData">
                              <li >Usuario que lo presto: {{bookData[0].userName}} {{ bookData[0].userSurname }}</li>
                            </div>
                        </div>
                    </ul>

                        <div *ngIf="element.borrow == 0">
                          <div class="form-group">
                                <label for="userBorrowed">Selecciona usuario que lo presta</label>
                                <select name="userBorrowed" #user="ngModel" [(ngModel)]="borrow_user_id" class="form-control" (change)="selectChangeHandler($event)">
                                    
                                    <option *ngFor="let user of users" value="{{user.id}}">
                                        {{user.name}}  {{user.surname}}
                                    </option>
                    
                                </select>
                                <br>
                                <button type="button" class="btn btn-primary" (click)='savelockBock(element.id, selectedValud)' data-dismiss="modal">Prestar</button>
                          </div>
                        </div>

                        <div *ngIf="element.borrow == 1">
                          <button type="button" class="btn btn-danger" (click)='unlockBook(element.id)' data-dismiss="modal">Devolver</button>
                        </div>

                </div>

                <!-- Modal footer -->
                <div class="modal-footer">
                    
                    <button type="button" class="btn btn-warning" data-dismiss="modal">Close</button>

                </div>

                </div>
            </div>
          </div>


        </div>


      </td>
     
      
    </ng-container>





    <tr mat-header-row *matHeaderRowDef="displayedColumns;"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

    

  </table>

  <mat-paginator [pageSizeOptions]="[3,10,20]" showFirstLastButtons></mat-paginator>

